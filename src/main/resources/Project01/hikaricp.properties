# ========================================
# HikariCP 数据库连接池配置文件
# ========================================

# 数据库连接信息（通过环境变量注入）
jdbcUrl=${DB_URL}
username=${DB_USER}
password=${DB_PASS}
driverClassName=com.mysql.cj.jdbc.Driver

# ========================================
# 核心连接池参数
# ========================================

# 最小空闲连接数
# 保持2个预连接，避免临时建立连接的延迟（跨地域场景重要）
minimumIdle=2

# 立即初始化连接池
initializationFailTimeout=1

# 最大连接数
# 根据并发用户数调整，小型应用建议10-20
maximumPoolSize=10

# 连接超时时间（毫秒）
# 跨地域访问建议放宽到10秒
connectionTimeout=10000

# 空闲连接最大存活时间（毫秒）
# 设置为10分钟，保持长连接复用，减少重建开销
idleTimeout=600000

# 连接最大生命周期（毫秒）
# 30分钟后自动刷新连接，避免长时间连接问题
maxLifetime=1800000

# ========================================
# 网络优化参数
# ========================================

# 连接测试查询
# 使用轻量级查询验证连接有效性
# connectionTestQuery=SELECT 1

# 连接验证超时时间（毫秒）
# 跨地域场景建议5秒
validationTimeout=3000

# 连接泄漏检测阈值（毫秒）
# 连接超过2分钟未归还将报警
leakDetectionThreshold=120000

# ========================================
# MySQL 性能优化参数
# ========================================

# 启用预编译语句缓存
# 减少SQL解析往返次数
dataSource.cachePrepStmts=true

# 预编译语句缓存大小
dataSource.prepStmtCacheSize=250

# 预编译语句SQL长度限制
dataSource.prepStmtCacheSqlLimit=2048

# 使用服务器端预编译
dataSource.useServerPrepStmts=true

# 使用本地会话状态
dataSource.useLocalSessionState=true

# 批量操作重写
# 将多条INSERT合并为单次请求
dataSource.rewriteBatchedStatements=true

# 缓存结果集元数据
dataSource.cacheResultSetMetadata=true

# 缓存服务器配置
dataSource.cacheServerConfiguration=true

# 优化自动提交设置
dataSource.elideSetAutoCommits=true

# 禁用时间统计（减少开销）
dataSource.maintainTimeStats=false

# ========================================
# TCP 网络层优化
# ========================================

# 启用TCP保活机制
# 防止长时间空闲连接被中间设备断开
dataSource.tcpKeepAlive=true

# Socket超时时间（毫秒）
# 60秒无响应则超时
dataSource.socketTimeout=60000
